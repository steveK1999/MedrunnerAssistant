<!-- Ship Assignment Tab HTML -->
<div class="tab-content" data-tab="shipAssignment">
    <h2>Ship Assignments</h2>
    <p class="description">Manage ship assignments and crew members for missions.</p>

    <!-- Import Success Banner -->
    <div id="import-success-banner" class="hidden" style="display: none;">
        <div class="alert alert-success" style="margin-bottom: 1rem;">
            <span id="import-success-message">Successfully imported!</span>
        </div>
    </div>

    <!-- Ship Groups Card -->
    <div class="card" style="margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem;">Ship Groups</h3>
        
        <div class="form-group" style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <input type="text" id="api-status" placeholder="Loading ships..." readonly style="flex: 1; min-width: 150px;">
            <button class="btn btn-secondary" onclick="loadShips()">Refresh Ships</button>
            <button class="btn btn-secondary" onclick="openImportModal()">Import from Discord</button>
            <button class="btn btn-danger" onclick="confirmClearShipAssignments()">Clear All</button>
        </div>

        <div id="ships-container" style="display: flex; flex-direction: column; gap: 1rem;">
            <!-- Ships will be rendered here -->
        </div>

        <button class="btn btn-primary" onclick="addShip()" style="margin-top: 1rem; width: 100%;">Add Ship</button>
    </div>

    <!-- Preview Card -->
    <div class="card">
        <h3 style="margin-bottom: 1rem;">Preview</h3>
        <div id="preview" style="background-color: #1a1a1a; color: #888; padding: 1rem; border-radius: 0.5rem; min-height: 100px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; word-wrap: break-word; margin-bottom: 1rem; border: 1px solid #333;">
            Add ships and crew members to see preview...
        </div>
        
        <!-- Success Message -->
        <div id="successMessage" class="hidden" style="display: none;">
            <div class="alert alert-success">✅ Copied to clipboard!</div>
        </div>

        <button class="btn btn-primary" onclick="copyToClipboard()" style="width: 100%;">COPY TO CLIPBOARD</button>
    </div>
</div>

<!-- After Action Report Tab HTML -->
<div class="tab-content" data-tab="aar">
    <h2>After Action Report</h2>
    <p class="description">Generate structured mission reports with ship assignments and location data.</p>

    <div class="card">
        <h3 style="margin-bottom: 1.5rem;">After Action Report</h3>

        <form id="aar-form">
            <!-- Ships Used Section -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="margin-bottom: 1rem; color: #4dabf7;">Ships Used</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <!-- Gunship -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Gunship</label>
                        <select id="aar-gunship" class="form-control">
                            <option value="">Select ship...</option>
                        </select>
                    </div>

                    <!-- Medical Ship -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Medical Ship</label>
                        <select id="aar-medical" class="form-control">
                            <option value="">Select ship...</option>
                        </select>
                    </div>
                </div>

                <!-- CAP Ships -->
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">CAP Ships</label>
                    <div id="aar-cap-container" style="margin-bottom: 0.5rem;">
                        <span id="aar-cap-empty" style="color: #888; font-size: 0.9rem; display: block; padding: 0.5rem;">No CAP ships assigned</span>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addCAPShipDropdown()" style="width: 100%;">Add CAP Ship</button>
                </div>

                <!-- Additional Ships -->
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Additional Ships</label>
                    <input type="text" id="aar-additional-ships" placeholder="List additional ships..." class="form-control">
                </div>
            </div>

            <!-- Mission Location Section -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="margin-bottom: 1rem; color: #4dabf7;">Mission Location</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <!-- Planet -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Planet/Location</label>
                        <select id="aar-planet" class="form-control">
                            <option value="">Select location...</option>
                        </select>
                    </div>

                    <!-- POI -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Point of Interest</label>
                        <select id="aar-poi" class="form-control">
                            <option value="">Select POI...</option>
                        </select>
                    </div>
                </div>

                <!-- Extraction Point -->
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Extraction Point</label>
                    <input type="text" id="aar-extraction" placeholder="Extraction location..." class="form-control">
                </div>
            </div>

            <!-- Mission Details Section -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="margin-bottom: 1rem; color: #4dabf7;">Mission Details</h4>
                
                <!-- Reason -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Reason</label>
                    <input type="text" id="aar-reason" placeholder="Reason for mission..." class="form-control">
                </div>

                <!-- Outcome -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Outcome</label>
                    <select id="aar-outcome" class="form-control">
                        <option value="">Select outcome...</option>
                        <option value="Success">Success</option>
                        <option value="Partial Success">Partial Success</option>
                        <option value="Failed">Failed</option>
                        <option value="Aborted">Aborted</option>
                    </select>
                </div>

                <!-- Casualties -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Casualties</label>
                    <input type="text" id="aar-casualties" placeholder="Report casualties..." class="form-control">
                </div>

                <!-- Notes -->
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Additional Notes</label>
                    <textarea id="aar-notes" placeholder="Any additional notes..." class="form-control" rows="4" style="resize: vertical;"></textarea>
                </div>
            </div>
        </form>

        <!-- Preview -->
        <div style="margin-bottom: 1rem;">
            <h4 style="margin-bottom: 0.5rem;">Preview</h4>
            <div id="aar-preview" style="background-color: #1a1a1a; color: #888; padding: 1rem; border-radius: 0.5rem; min-height: 150px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; word-wrap: break-word; border: 1px solid #333;">
                Fill in AAR details to see preview...
            </div>
        </div>

        <!-- Success Message -->
        <div id="aar-successMessage" class="hidden" style="display: none;">
            <div class="alert alert-success" style="margin-bottom: 1rem;">✅ Copied to clipboard!</div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="copyAARToClipboard()" style="flex: 1; min-width: 150px;">Copy to Clipboard</button>
            <button class="btn btn-secondary" onclick="clearAARForm()" style="flex: 1; min-width: 150px;">Clear Form</button>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div id="import-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <h3>Import from Discord</h3>
        <p style="margin-bottom: 1rem; color: #999;">
            Paste a Discord ship assignment message to import all ships and crew members.
        </p>

        <textarea id="import-discord-message" placeholder="Paste Discord message here..." class="form-control" rows="10" style="margin-bottom: 1rem; resize: vertical;"></textarea>

        <!-- Status Message -->
        <div id="import-status" class="hidden" style="display: none; margin-bottom: 1rem;"></div>

        <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-primary" onclick="importFromDiscord()" style="flex: 1;">Import</button>
            <button class="btn btn-secondary" onclick="closeImportModal()" style="flex: 1;">Cancel</button>
        </div>
    </div>
</div>

<datalist id="crew-name-suggestions"></datalist>
<datalist id="crew-discord-suggestions"></datalist>

<style>
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-content {
        background-color: #2a2a2a;
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid #444;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #444;
        border-radius: 0.375rem;
        background-color: #1a1a1a;
        color: #fff;
        font-size: 0.875rem;
    }

    .form-control:focus {
        outline: none;
        border-color: #4dabf7;
        box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.1);
    }

    .card {
        background-color: #2a2a2a;
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid #444;
        margin-bottom: 1rem;
    }

    .alert {
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
    }

    .alert-success {
        background-color: #1a5f1a;
        color: #4ade80;
        border: 1px solid #166b16;
    }

    .hidden {
        display: none !important;
    }

    .ship-card {
        background-color: #1a1a1a;
        padding: 1rem;
        border-radius: 0.375rem;
        border: 1px solid #444;
    }

    .crew-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
</style>
